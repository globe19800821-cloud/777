<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>å¯¦æ™‚æµ®å‹•éŠæˆ² AI ç›£æ§</title>
<style>
body { font-family: Arial; margin: 20px; }
#status { font-weight: bold; margin-top: 10px; }
.bigwin { color: red; font-size: 1.5em; font-weight: bold; }
#videoPreview { border:1px solid #ccc; width:480px; height:270px; }
#trend { margin-top:10px; }
</style>
</head>
<body>
<h2>æµ®å‹•éŠæˆ² AI ç›£æ§ + å¤§çè­¦å ±</h2>
<p>è«‹é–‹å•ŸéŠæˆ²åˆ†é ï¼Œç„¶å¾ŒæŒ‰ã€Œé–‹å§‹ç›£æ§ã€å…è¨±æŠ“å–ç•«é¢ã€‚</p>

<button id="startCapture">é–‹å§‹ç›£æ§</button><br>
<video id="videoPreview" autoplay muted></video>
<div id="status">ç‹€æ…‹ï¼šå°šæœªé–‹å§‹</div>
<div id="trend"></div>

<script>
let monitoring = false;
let stream = null;
let history = []; // ç´€éŒ„æ¯æ¬¡ç‰¹å¾µåˆ†æ

// é–‹å§‹æ•ç²è¢å¹•
document.getElementById("startCapture").addEventListener("click", async ()=>{
  try{
    stream = await navigator.mediaDevices.getDisplayMedia({video:true});
    const video = document.getElementById("videoPreview");
    video.srcObject = stream;
    monitoring = true;
    document.getElementById("status").innerText = "ç‹€æ…‹ï¼šç›£æ§ä¸­...";
    monitorLoop();
  }catch(e){
    alert("å¿…é ˆå…è¨±è¢å¹•æ•ç²æ‰èƒ½ç›£æ§");
    console.error(e);
  }
});

// æ¨¡æ“¬ç‰¹å¾µæå–
function extractFeaturesFromFrame(){
  // çœŸå¯¦ç‰ˆæœ¬å¯ä»¥ç”¨ Canvas åˆ†æ pixels
  return [
    Math.random(), // ç©ºè½‰æ¯”ä¾‹
    Math.random(), // å¹³å‡å‹•ç•«æ™‚é–“
    Math.random(), // ç‰¹æ®Šç¬¦è™Ÿ
    Math.random(), // ç•«é¢äº®åº¦
    Math.random()  // ç¯€å¥
  ];
}

// AI åˆ¤æ–·åå¸/åå
function predictState(features){
  const score = features[0]*0.4 + (1-features[1])*0.3 + (1-features[2])*0.2 + (1-features[3])*0.1;
  if(score>0.7) return "åå¸åˆ†";
  else if(score>0.4) return "ä¸­æ€§";
  else return "åååˆ†";
}

// å¤§çè­¦å ±
function checkBigWin(features){
  const score = 0.5*features[1] + 0.4*features[2] + 0.1*features[3];
  if(score>0.7){
    document.getElementById("status").innerHTML = '<span class="bigwin">ğŸ”¥ å¤§çè­¦å ±ï¼ ğŸ”¥</span>';
    // å¯é¸åŠ è²éŸ³
    // new Audio('alert.mp3').play();
    return true;
  }
  return false;
}

// ä¸»å¾ªç’°
function monitorLoop(){
  if(!monitoring) return;
  const features = extractFeaturesFromFrame();
  history.push(features);
  if(history.length>10) history.shift(); // ä¿æŒæœ€è¿‘10ç­†
  checkBigWin(features);
  const state = predictState(features);
  document.getElementById("status").innerText += ` åå‘ç‹€æ…‹ï¼š${state}`;

  // é¡¯ç¤ºç°¡å–®è¶¨å‹¢
  let trendText = "æœ€è¿‘è¶¨å‹¢ï¼š";
  history.forEach((f,i)=>{ trendText += `[${i+1}:${predictState(f)}] `; });
  document.getElementById("trend").innerText = trendText;

  setTimeout(monitorLoop,1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
}
</script>
</body>
</html>  checkBigWin(features);
  const state = predictState(features);
  document.getElementById("status").innerText += ` åå‘ç‹€æ…‹ï¼š${state}`;
  setTimeout(monitorLoop,1000); // æ¯ç§’æ›´æ–°ä¸€æ¬¡
}
</script>
</body>
</html>
